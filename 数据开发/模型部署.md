模型部署
===
持久化模型 -> <br/>运行服务器加载模型(模型加载与模型管理方法) -> <br/>提供服务接口，如REST

Index
---
- [持久化模型and加载模型](#持久化模型and加载模型)
- [服务器加载模型and构建API](#服务器加载模型and构建API)
- [其他模型部署方式](#其他模型部署方式)
- [Reference](#Reference)



## 持久化模型and加载模型
- python<br/>
```
## 模板：序列化模型并存为文件
from sklearn.externals import joblib
... training to get the clf
joblib.dump(clf, 'classification.pkl') ## clf是模型对象
## 模板：加载并反序列化模型
clf = joblib.load('classification.pkl')
```
- spark<br/>
```
## 模板：序列化模型并存储到文件
from pyspark.ml import Pipeline
... set the pipeline
... training to get the model
pipeline.write().overwrite().save("{}/classification-pipeline".format(filebase))
model.write().overwrite().save("{}/classification-model".format(filebase))
## 模板：加载并反序列化模型
form pyspark.ml import Pipeline
from pyspark.ml import PipelineModel
pipeline = Pipeline.read().load("{}/classification-pipeline".format(filebase))
model = PipelineModel.read().load("{}/classification-model".format(filebase))
```
- tensorflow<br/>
```
## 模板：序列化模型并存储到文件
import tensorflow as tf
... training to get the sess
tf.train.Saver().save(sess,"/tmp/model.ckpt")  
## 模板：加载并反序列化模型
new_saver = tf.train.import_meta_graph('/tmp/model.ckpt.meta') # 加载图结构
newer_saver.restore(sess, '/tmp/model.ckpt') # 加载变量值
```

## 服务器加载模型and构建API
- 步骤<br/>
步骤1：建立模型<br/>
步骤2：模型写入pickle文件<br/>
步骤3：构建一个基于flask的API<br/>
步骤4：通过API调用模型<br/>
- 工具包<br/>
flask 一个轻量级的web框架<br/>
flask.ext.restful 快速生成restful api<br/>
numpy 数值计算包<br/>
pickle 用来保存模型<br/>
sklearn 用来建模<br/> 
- [examples](../测试/模型api部署.py)

## 其他模型部署方式
- 部署方案总结<br/>
![示例](../图片/模型部署.png)<br/>
从简到难的部署方案<br/>
  - PMML<br/>
  [examples]()
  - java服务类直接调用shell命令执行python代码
  - tensorflow-serving
  - Python SOA<br/>
  ![示例](../图片/Python SOA.png)
  
  



## Reference
- [生产环境中进行机器学习模型部署using Flask](https://zhuanlan.zhihu.com/p/42418356)
- [干货|机器学习算法线上部署方法](https://zhuanlan.zhihu.com/p/23382412)
- [Python算法模型常用部署方式总结](http://knightyang.com/2017/10/18/python%E7%AE%97%E6%B3%95%E6%A8%A1%E5%9E%8B%E5%B8%B8%E7%94%A8%E9%83%A8%E7%BD%B2%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/)
- [在生产环境使用 Kafka 构建和部署大规模机器学习](https://www.infoq.cn/article/build-deploy-scalable-machine-learning-production-kafka)
- [关于商业部署机器学习，这有一篇详尽指南](https://www.jiqizhixin.com/articles/2018-07-13-6)
- [谈谈机器学习模型的部署](https://my.oschina.net/taogang/blog/2222908)
- [REST服务与RestfulAPI风格](https://www.jianshu.com/p/43dae0b83755)
- [用大白话给你科普，到底什么是 API（应用程序编程接口）？](http://baijiahao.baidu.com/s?id=1597881116201407882&wfr=spider&for=pc)
- [tensorflow加载模型并测试的方法](https://blog.csdn.net/sjtuxx_lee/article/details/82663394)
- [SOA （面向服务的架构）](https://baike.baidu.com/item/SOA/2140650?fr=aladdin)
- [机器学习模型部署：pmml+springboot](https://www.jianshu.com/p/cf90ca0c2a74)
- [模型上线和pmml简介](http://tech.dianwoda.com/2018/07/18/mo-xing-shang-xian-he-pmmljian-jie/)
